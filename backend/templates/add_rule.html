<!DOCTYPE html>
<html>
<head>
  <title>PSKnow</title>
    <link rel="stylesheet" type="text/css" href="/css/navbar.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.6/css/selectize.default.min.css">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='rule_form.css') }}">
    <script src="http://code.jquery.com/jquery-1.10.2.js" type="text/javascript"></script>
    <script src="../static/rule_add.js"></script>
    <script src="../static/selectize.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<body>
  <ul class=navbar>
    <li><a href='/'>Home</a></li>
    <li><a href='/admin/'>Admin</a></li>
    <li><a href='/rules/'>Rules</a></li>
    <li style="float:right"><a href='/logout/'>Logout</a></li>
  </ul>

  <br>
  <form action="/add_rule/" method="post" id="rule-form" enctype="multipart/form-data">
    <h2>Add a customized rule</h2>
    <label for="name"><b>Name</b></label><br>
    <input type="text" id="name" name="name" placeholder="Enter rule name" onchange="setName()" required><br><br>

    <label><b>Type</b></label><br>
    <select id="type" name="type">
      <option value="6" hidden>Select rule type</option>
      <option value="scrambler">scrambler</option>
      <option value="wordlist">wordlist</option>
      <option value="john">john</option>
      <option value="generated">generated</option>
      <option value="mask_hashcat">mask_hashcat</option>
      <option value="filemask_hashcat">filemask_hashcat</option>
    </select><br><br>

    <label for="priority"><b>Priority</b></label><br>
    <input type="number" id="priority" name="priority" onchange="setPriority()" placeholder="Enter rule priority" required><br><br>

    <label for="description"><b>Description</b></label><br>
    <input type="text" id="description" name="description" placeholder="Enter rule description" required><br><br>

    <label for="examples"><b>Examples</b></label><br>
    <input type="text" id="examples" name="examples" placeholder="Enter examples"><br>

    <label><b>Languages</b></label><br>
    <select placeholder="Select languages" id="languages" name="languages" multiple>
      <option value="english">English</option>
      <option value="romanian">Română</option>
      <option value="french">Français</option>
      <option value="deutsch">Deutsch</option>
      <option value="spanish">Español</option>
    </select><br>

    <label for="link"><b>Link</b></label><br>
    <input type="text" id="link" name="link" placeholder="Enter link"><br><br>

    <div id="dynamic"></div>
    <input type="submit"/>

    <script>
      function setName() {
        let name = document.getElementById("name").value;
        {% for nm in names %}
          if (name === "{{nm}}") {
            document.getElementById("name").value = "";
            alert("Duplicate name: " + name + ". Please choose another name for your rule.");
          }
        {% endfor %}
      }

      function setPriority() {
          let priority = document.getElementById("priority").value;

          {% for prio in priorities %}
             if (priority == {{prio}}) {
                document.getElementById("priority").value = "";
                alert("Duplicate priority: " + priority + ". Please choose another priority for your rule.");
             }
          {% endfor %}

        if (isNaN(Number(priority))) {
            document.getElementById("priority").value = "";
            alert("Not a number.")
          }
       }
    </script>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
         {% for type,message in messages %}
            {% if type == 'success' %}
            <div style='color:green'>
            {{ message }}
            </div>
            {% elif type == 'warning' %}
            <div style='color:OrangeRed'>
            {{ message }}
            </div>
            {% else %}
            <div style='color:red'>
            {{ message }}
            </div>
            {% endif %}
         {% endfor %}
      {% endif %}
   {% endwith %}
  </form>
</body>
</html>